{% extends "base.html" %}{% block content %}
<div class="toggle">
  <a class="chip {{ 'active' if h == 0 else '' }}" href="/?h=0">Now</a>
  <a class="chip {{ 'active' if h == 3 else '' }}" href="/?h=3">+3h</a>
  <a class="chip {{ 'active' if h == 6 else '' }}" href="/?h=6">+6h</a>
</div>

<section class="spots">
{% for item in items %}
<article class="spot-card">
  <div class="spot-main">
    <h2>{{ item.spot.name }}</h2>
    <p class="meta">Score: <span class="pill {{ item.bucket }}">{{ item.bucket }}</span> ({{ '%.0f' % item.score }})</p>
    <p class="reason">{{ item.reason }}</p>
    <details><summary>Notes</summary><p>{{ item.spot.notes }}</p></details>
  </div>
  <div class="spot-actions">
    <form method="post" action="/checkins" class="checkin-form">
      <input type="hidden" name="spot_id" value="{{ item.spot.id }}">
      <label>User</label><input type="text" name="user_id" placeholder="your handle" required>
      <label>Arrive start</label><input type="datetime-local" name="arrive_start" required>
      <label>Arrive end</label><input type="datetime-local" name="arrive_end" required>
      <label>Note</label><input type="text" name="note" placeholder="board, car space, etc.">
      <label>Visibility</label><select name="visibility"><option value="friends">Friends</option><option value="public">Public</option></select>
      <button type="submit">I'm going here</button>
    </form>
  </div>
</article>
{% endfor %}
</section>

<section class="map-wrap"><div id="map" class="map"></div></section>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const map = L.map('map').setView([44.0, -87.7], 8);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 18, attribution: '&copy; OpenStreetMap contributors'}).addTo(map);
  const items = {{ items_js | tojson }};
  items.forEach(it => {
    const color = it.bucket === 'epic' ? 'green' : it.bucket === 'good' ? 'blue' : it.bucket === 'ok' ? 'orange' : 'red';
    L.circleMarker([it.spot.lat, it.spot.lng], { radius: 8, color }).addTo(map)
      .bindPopup(`<b>${it.spot.name}</b><br/>${it.reason}<br/><i>${it.bucket}</i>`);
  });
});
</script>
{% endblock %}
